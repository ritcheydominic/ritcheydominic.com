<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
    <head>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-B1FYVFCK1L"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-B1FYVFCK1L');
        </script>
        
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Dominic Ritchey">
        <title>Dominic Ritchey • FPGA Fire Alarm Control Panel</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

        <!-- Favicons -->
        <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
        <link rel="manifest" href="../site.webmanifest">
        <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="theme-color" content="#ffffff">

        <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
            font-size: 3.5rem;
            }
        }

        .b-example-divider {
            width: 100%;
            height: 3rem;
            background-color: rgba(0, 0, 0, .1);
            border: solid rgba(0, 0, 0, .15);
            border-width: 1px 0;
            box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
        }

        .b-example-vr {
            flex-shrink: 0;
            width: 1.5rem;
            height: 100vh;
        }

        .bi {
            vertical-align: -.125em;
            fill: currentColor;
        }

        .nav-scroller {
            position: relative;
            z-index: 2;
            height: 2.75rem;
            overflow-y: hidden;
        }

        .nav-scroller .nav {
            display: flex;
            flex-wrap: nowrap;
            padding-bottom: 1rem;
            margin-top: -1px;
            overflow-x: auto;
            text-align: center;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .btn-bd-primary {
            --bd-violet-bg: #712cf9;
            --bd-violet-rgb: 112.520718, 44.062154, 249.437846;

            --bs-btn-font-weight: 600;
            --bs-btn-color: var(--bs-white);
            --bs-btn-bg: var(--bd-violet-bg);
            --bs-btn-border-color: var(--bd-violet-bg);
            --bs-btn-hover-color: var(--bs-white);
            --bs-btn-hover-bg: #6528e0;
            --bs-btn-hover-border-color: #6528e0;
            --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);
            --bs-btn-active-color: var(--bs-btn-hover-color);
            --bs-btn-active-bg: #5a23c8;
            --bs-btn-active-border-color: #5a23c8;
        }
        .bd-mode-toggle {
            z-index: 1500;
        }
        </style>
    </head>
    <body>
    <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
      <symbol id="check2" viewBox="0 0 16 16">
        <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path>
      </symbol>
      <symbol id="circle-half" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path>
      </symbol>
      <symbol id="moon-stars-fill" viewBox="0 0 16 16">
        <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path>
        <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path>
      </symbol>
      <symbol id="sun-fill" viewBox="0 0 16 16">
        <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path>
      </symbol>
    </svg>

    <header data-bs-theme="dark">
    <div class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container">
        <a href="../index.html" class="navbar-brand d-flex align-items-center">
            <strong>Dominic Ritchey</strong>
        </a>
        </div>
    </div>
    </header>

    <main>

    <section class="py-5 text-center container">
        <div class="row py-lg-4">
        <div class="col-lg-6 col-md-8 mx-auto">
            <h1 class="fw-light">FPGA Fire Alarm Control Panel</h1>
            <span class="badge bg-success-subtle border border-success-subtle text-success-emphasis rounded-pill mb-2">Completed • March - April 2023</span>
            <p class="lead text-body-secondary mb-2">Verilog • Vivado Design Suite • Assembly • GTKWave</p>
            <p class="lead text-body-secondary mb-2">Collaborators: Cole Weber</p>
        </div>
        </div>
    </section>

    <div class="album py-5 bg-body-tertiary">
        <div class="container col-lg-7">
            <p>For Duke's digital systems class (ECE 350), students are tasked with making a pipelined processor in Verilog that can run on an FPGA, which in our case was a Nexus A7. We debugged our Verilog components with GTKWave, and we then utilized the Vivado Design Suite to synthesize and implement the design of the logic circuits in our Verilog. This processor is then used to make a final project, where my partner and I designed a fire alarm control panel (FACP). Our FACP has a conventional IDC (initiating device circuit), a NAC (notification appliance circuit) and a resettable power circuit. The NAC incorporates System Sensor's 2-wire synchronization and audible silence protocol. The FACP also has a user interface consisting of LEDs for alarm (red), silenced (yellow) and normal (green) status and buttons for silencing and resetting the system.</p>
            <div class="text-center">
                <iframe width="560" height="315" src="https://www.youtube.com/embed/So-1_h588_c?si=jAn9KlCv1o5KtKfH" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                <p class="text-body-secondary">The official project video recorded by Dr. John Board.</p>
                <iframe width="560" height="315" src="https://www.youtube.com/embed/-y9sFf2HE08?si=7LcVTZO9fpJeXIrt" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                <p class="text-body-secondary">An additional video I filmed testing the FACP.</p>
            </div>
            <p>The processor running the FACP has a pipeline composed of the 5 simple RISC pipeline stages: fetch (F), decode (D), execute (X), memory (M) and write (W). This design necessitated the implementation of stalling in case of a memory load followed by an instruction dependent on the load's result. Bypassing (X/W, X/M and M/W) was also added to increase performance by reducing the need for stalling. The ALU incorporates a two-stage carry-look-ahead adder to allow for a shorter clock period (and thus higher clock frequency). While not used in the FACP, a multiplier/divider utilizing Booth's algorithm and non-restoring division was also included in the processor.</p>
            <p>Our conventional IDC consists of initiating devices (smoke detectors, manual pull stations, etc.) connected in parallel with one side of their switches connected to an FPGA Pmod pin and the other side connected to a 3.3 V power source. The side connected to the FPGA Pmod pin is tied to ground using a pull-down resistor in a normal state. When a device triggers, it closes its switch, bringing the side connected to the FPGA's Pmod pin to 3.3 V. The processor then detects this by polling the value of a register dedicated to I/O (as are other inputs, such as the silence and reset buttons).</p>
            <div class="text-center">
                <img src="../assets/facp-idc.jpg" width="560px" height="100%" alt="Circuit diagram for the IDC">
                <p class="text-body-secondary">Circuit diagram for the IDC.</p>
            </div>
            <p>When an alarm condition is detected, the FACP begins modulating the NAC in accordance with the selected synchronization protocol (in our case, we used System Sensor's). The NAC is composed of another Pmod pin being modulated by a change in the I/O register's value. The Pmod pin, which outputs a maximum of 3.3 V, is connected to a relay switching a 24-V power supply for the notification appliances (horns, strobes, etc.).</p>
            <div class="text-center">
                <img src="../assets/facp-nac.jpeg" width="560px" height="100%" alt="Circuit diagram for the NAC">
                <p class="text-body-secondary">Circuit diagram for the NAC.</p>
            </div>
            <p>As mentioned earlier, the NAC is modulated according to System Sensor's 2-wire synchronization and audible silence protocol. This allows the system to sound the horns in temporal code 3 (and silence them) and keep the strobes flashing in sync over only 2 wires. The protocol's signaling pattern was determined by connecting a <a href="https://prod-edam.honeywell.com/content/dam/honeywell-edam/hbt/en-us/documents/manuals-and-guides/installation-guides/I56-3157-003R.pdf?download=false">System Sensor MDL3 synchronization module</a> I had on hand to an oscilloscope. The pattern was then incorporated into the processor's assembly code as a finite state machine of sorts.</p>
            <div class="text-center">
                <img src="../assets/facp-sync-fsm.jpg" width="560px" height="100%" alt="State diagram for the System Sensor 2-wire synchronization and audible silence protocol">
                <p class="text-body-secondary">State diagram for the System Sensor 2-wire synchronization and audible silence protocol.</p>
            </div>
            <p>Because the synchronization pattern relies on precise timing, we needed to add timer hardware and assembly instructions to use it into our processor. We decided to create a simple cycle counter, which increments a register every clock cycle after the <i>sct</i> (set cycle timer) instruction is called until it reaches the value provided as an immediate. The <i>bce</i> (branch if cycles elapsed) instruction can then be used to branch to a different part of the program if it has reached the threshold cycle count. Since our processor runs at a fixed frequency, we could use that to calculate how many cycles correspond to the timings for each stage of the synchronization/silencing protocol.</p>
            <div class="text-center">
            <table class="table table-hover">
                <thread>
                    <tr>
                        <th scope="col">Instruction</th>
                        <th scope="col">Type</th>
                        <th scope="col">Opcode (ALU Opcode)</th>
                        <th scope="col">Description</th>
                    </tr>
                </thread>
                <tbody>
                    <tr>
                        <th scope="row">and $rd, $rs, $rt</th>
                        <td>R</td>
                        <td>00000 (00010)</td>
                        <td>$rd = $rs & $rt</td>
                    </tr>
                    <tr>
                        <th scope="row">j T</th>
                        <td>JI</td>
                        <td>00001</td>
                        <td>PC = T</td>
                    </tr>
                    <tr>
                        <th scope="row">bne $rd, $rs, N</th>
                        <td>I</td>
                        <td>00010</td>
                        <td>If $rd != $rs, PC = PC + 1 + N</td>
                    </tr>
                    <tr>
                        <th scope="row">addi $rd, $rs, $rt</th>
                        <td>I</td>
                        <td>00101</td>
                        <td>$rd = $rs + N</td>
                    </tr>
                    <tr>
                        <th scope="row">sct N</th>
                        <td>JI</td>
                        <td>10111</td>
                        <td>Start cycle counter with threshold value N</td>
                    </tr>
                    <tr>
                        <th scope="row">bce T</th>
                        <td>JI</td>
                        <td>11000</td>
                        <td>If cycle counter is at threshold, PC = T</td>
                    </tr>
                </tbody>
            </table>
            <p class="text-body-secondary">Table of the instructions used in the FACP's assembly programming.</p>
        </div>
            <p>Certain initiating devices like conventional smoke detectors require a reset of their power supply to clear an alarm condition and reset their switch. To accommodate this, we connected a Pmod pin to a relay switching the 24-V power supply. When the FACP is reset, it interrupts the power supply for several seconds before reconnecting it and returning the system to a normal status.</p>
            <div class="text-center">
                <img src="../assets/facp-rps.jpeg" width="560px" height="100%" alt="Circuit diagram for the resettable power supply">
                <p class="text-body-secondary">Circuit diagram for the resettable power supply.</p>
            </div>
            <p>Had we been given more time for the final project, there were 3 things we wanted to improve on the FACP. First, using an analog-to-digital converter (ADC) for the IDC would have allowed us to implement zone supervision with an end-of-line resistor. This could then detect if the IDC's wiring was cut and indicate a trouble condition on the FACP. Second, we could have implemented interrupts for both input state changes and the timer as opposed to using polling for them. While more architecturally complex, this setup more closely models embedded systems, which are typically the microcontroller of choice for FACPs and other life safety systems. Finally, we wanted to implement a more user-friendly interface using an LCD display to show a readout of the system's status, zone names, etc.</p>
            <p>Due to course restrictions, posting the project's Verilog or assembly code publicly on GitHub is a violation of the Duke Community Standard. However, I would be more than happy to show and discuss this project's underlying work one-on-one.</p>
        </div>
    </div>

    </main>

    <footer class="text-body-secondary py-5">
        <div class="container">
            <div class="hstack gap-3">
                <div class="p-2">
                    <p class="mb-1">You can also find me here ↓</p>
                    <div class="grid gap-3">
                        <a href="https://github.com/ritcheydominic" class="p-1 g-col-6 icon-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
                                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                            </svg>
                        </a>
                        <a href="https://www.linkedin.com/in/ritcheydominic/" class="p-2 g-col-6 icon-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16">
                                <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/>
                            </svg>
                        </a>
                        <a href="mailto:ritcheydominic@gmail.com" class="p-2 g-col-6 icon-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope-fill" viewBox="0 0 16 16">
                                <path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555ZM0 4.697v7.104l5.803-3.558L0 4.697ZM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757Zm3.436-.586L16 11.801V4.697l-5.803 3.546Z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="p-2 ms-auto">
                    <p class="mb-1"><a href="../secure-messaging.html">PGP Fingerprint: D7A4 79E5 54E9 105A A928  E412 97F1 416F E738 233C</a></p>
                    <p class="float-end mb-1"><a href="#">Back to top</a></p>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
</body>
</html>